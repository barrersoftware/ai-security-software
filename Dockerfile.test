FROM ubuntu:22.04

# Prevent interactive prompts
ENV DEBIAN_FRONTEND=noninteractive

# Install system utilities and dependencies
RUN apt-get update && apt-get install -y \
    curl \
    wget \
    git \
    sudo \
    systemd \
    iptables \
    iproute2 \
    ca-certificates \
    gnupg \
    lsb-release \
    vim \
    net-tools \
    iputils-ping \
    && rm -rf /var/lib/apt/lists/*

# Install Node.js 20.x LTS
RUN curl -fsSL https://deb.nodesource.com/setup_20.x | bash - \
    && apt-get install -y nodejs \
    && rm -rf /var/lib/apt/lists/*

# Verify Node.js installation
RUN node --version && npm --version

# Create test user with sudo privileges
RUN useradd -m -s /bin/bash tester \
    && echo "tester:tester" | chpasswd \
    && echo "tester ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers

# Set working directory
WORKDIR /home/tester

# Copy a test script
COPY --chown=tester:tester test-in-docker.sh /home/tester/test-scanner.sh
RUN chmod +x /home/tester/test-scanner.sh

# Switch to test user
USER tester

# Default command
CMD ["/bin/bash"]
